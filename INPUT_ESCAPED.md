"# Golem 1.2 internal testing hackathon results\n\n- Critical missing features\n    - Done\n- Critical problems with existing features\n    - Done\n- Critical bugs\n    - Done\n    - To-do\n- Critical documentation improvements\n    - Done\n    - TODO\n- Non-critical missing features\n    - Done\n    - TODO\n- Non-critical but annoying UX\n    - Done\n    - To-do / In-progress\n- Wrong UX not immediately fixable\n\nThis document summarizes the found issues of the pre-1.2 internal testing\nhackathon from each participants. The issues are categorized by severity to help\nGolem 1.2 internal testing hackathon results 1scheduling the final set of tasks. (To be reviewed and adjusted together)\nEach issue indicates who discovered it for easier tracking / gathering further info.\n\n## Critical missing features\n\nThe items in this section are new things to be implemented before 1.2\n\n### Done\n\n- @vigoo@ziverge.com The original issue I ran into is that because the file-server bindings are pointing to a specific\n  component version, this makes the iterative development very painful. In my example I was using it for hosting a\n  frontend through an ephemeral component’s read-only IFS entries. Because of the specific component version, a new API\n  definition must be created and deployed after every change of the frontend.\n    - In general, I think the missing feature we should add is that for file-system ephemeral bindings we don’t require\n      a component version but always use the latest one. (Maybe this is true for other binding types in case of\n      ephemeral components - but for Rib I guess we still need a baseline for type\n      checking) - https://github.com/golemcloud/golem/pull/1434\n- @vigoo@ziverge.com It is not possible to define a binding for `/` . I wanted to bind that to my frontend (`index.html`\n  in an ephemeral component) - https://github.com/golemcloud/golem/pull/1435\n- @vigoo@ziverge.com - It is extremely hard to construct worker URI for RPC for ephemeral workers using the new\n  component name resolution APIs. We Golem 1.2 internal testing hackathon results 2have everything needed to do for\n  durable workers (component-id + name), but for ephemeral ones, we can resolve the component id by name, but then we\n  cannot construct the urn:worker:<component-id> string. The reason is the WIT component-id type is a u64 pair (\n  representing an uuid) and there is no way to easily convert that to a string (without knowing that it is a uuid and\n  implementing an uuid to string conversion). In Rust the golem-rust crate at least has a conversion from the WIT Uuid\n  to the “real” uuid::Uuid.\n    - For now, we should add a variant of the worker_id host function that generates an ephemeral one by only taking a\n      component-id.\n    - Post 1.2 we should not use URIs in the location parameter of RPC resources\n    - https://github.com/golemcloud/golem/pull/1432\n- @vigoo@ziverge.com Missing --version or similar command in the new\n  CLI - https://github.com/golemcloud/golem-cli/pull/153\n\n## Critical problems with existing features\n\nThe items in this section are problems (not bugs, by design) with existing features\nto be improved before 1.2\n\n### Done\n\n- @vigoo@ziverge.com The strict worker name rules are too restricting - for\n  example it is not possible to use email address as worker name. This,\n  combined with the fact that there are no string manipulation functions and\n  things like base64 encoding in Rib yet, has a lot of consequences like the\n  need for over-complicated architecture with proxy workers.\n    - We should have a much lighter worker name rule (for example only prohibiting / and whitespace?)\n    - https://github.com/golemcloud/golem/pull/1431\n- @vigoo@ziverge.com Not enough information presented when the API definition yaml could not be parsed.\n    - It should have enough information to immediately understand what to fix in the source file\n    - Note: this may be already fixed, but let’s recheck.\n    - https://github.com/golemcloud/golem-cli/pull/147\n- @vigoo@ziverge.com If the request to API gateway does specified an Accept header as */* (default in curl ), I think it\n  should assume that it is application/json. Right now this is not what is happening, and it returns with an error that\n  it could not figure out how to response.\n    - https://github.com/golemcloud/golem/pull/1431\n- @vigoo@ziverge.com When registering an API definition and there is an error in one of the Rib scripts, the error\n  message does not say which endpoint the problem belongs to.\n    - https://github.com/golemcloud/golem/pull/1431\n- @vigoo@ziverge.com API definitions are still referencing components for each endpoint by component-id. This is a\n  problem because otherwise we removed them from the whole user experience. Components are managed “automatically” by\n  deploy commands of the CLI.\n    - Even if we re-add showing component IDs in CLI output, it is inconvenient to fill in the API definitions\n      especially when there are many different components in the app\n    - With golem run server --clean available and being used as part of the developer workflow, it means that during\n      development and testing the components will get assigned new IDs from time to time. Currently in that case the API\n      definitions need to be rewritten by hand to contain the new UUIDs.\n    - So I think we should make the API definition use component names as part of 1.2\n    - https://github.com/golemcloud/golem/pull/1444\n- Make sure numbers are allowed for path and query parameters, even if Rib script requirements are string (global\n  variables are by default string) - this is more of a regression that happened due to lacking tests.\n    - by Afsal https://github.com/golemcloud/golem/pull/1447\n- Remove unnecessary query and path parameter lookups (and collecting them to HashMap) if they are unused in Rib.\n    - by Afsal https://github.com/golemcloud/golem/pull/1447\n\n## Critical bugs\n\nThe items in this section are critical bugs to be fixed before 1.2\n\n### Done\n\n- @vigoo@ziverge.com ~Weird Rib error about global variables not allowed~\n    - by @Afsal Thaj https://github.com/golemcloud/golem/pull/1430\n- @vigoo@ziverge.com A comma after the last case of a match in Rib results in a very scary error message and it is very\n  hard to figure out what causes it.\n    - by @Afsal Thaj https://github.com/golemcloud/golem/pull/1437 (merged through another PR)\n    - Details\n        - For this script, this is the error returned:\n\n```\nlet email = \"user@test.com\";\nlet temp_worker = instance(\"__accounts_proxy\");\nlet user = temp_worker.get-user-name(email);\nlet worker = instance(user);\nlet result = worker.create-store(request.body);\nmatch res {\nGolem 1.2 internal testing hackathon results 5ok(_) ⇒ { status: 200, body: empty },\nerr(already-exists) ⇒ { status: 400, body: \"Store already exists\" },\n}\n```\n\n```\nerror: API Definition Service - Error: 400 Bad Request, Parse error at line:\nUnexpected `}`\nExpected none, letter, digit, `_`, `-`, (, [, {, for, reduce, match, let, if, whitesp\nUnable to parse custom constructor name\nUnable to parse alias name\nInvalid syntax for flag type\nInvalid syntax for record type\nUnable to parse flag or record\nnamespace\npackage\ninterface\nInvalid function call\nInvalid syntax for pattern match\nInvalid syntax for tuple type\nInvalid literal\nUnable to parse not\nInvalid syntax for Option type\nInvalid syntax for Result type\nInvalid syntax for sequence type\n```\n\n- @vigoo@ziverge.com Rib scripts are returning strings without the \"\" when content type is JSON, which is NOT a valid\n  JSON.\n    - by @Afsal Thaj : https://github.com/golemcloud/golem/pull/1438\n- @Maxim Schuwalow api-definitions: query and path namespace sharing in rib is very\n  surprising https://github.com/golemcloud/golem/blob/main/golem-worker-service-base/src/gateway_execution/request.rs#L134\n    - by @Afsal Thaj : https://github.com/golemcloud/golem/pull/1439\n- @Afsal Thaj (TBC) Either make sure the value in request.body is of required type (this is to be confirmed as we can\n  already see some validation, but need to confirm it) and if this validation kills performance, let the rib interpreter\n  returns proper error message.\n    - by @Afsal Thaj : https://github.com/golemcloud/golem/pull/1441\n- @Maxim Schuwalow: Very hard error messages when there is a type mismatch requirement\n    - by @Afsal Thaj : https://github.com/golemcloud/golem/pull/1441\n\n```\nHTTP/1.1 400 Bad Request\ncontent-length: 463\ndate: Tue, 18 Mar 2025 13:23:41 GMT\nInvalid input: Input request doesn't match the requirements for rib expression\nto execute: Key 'query' not found in json_map. Requirements. Record(TypeRe\ncord { fields: [NameTypePair { name: \"path\", typ: Record(TypeRecord { fields:\n[NameTypePair { name: \"user-id\", typ: Str(TypeStr) }] }) }, NameTypePair { na\nme: \"query\", typ: Record(TypeRecord { fields: [NameTypePair { name: \"after\",\ntyp: U64(TypeU64) }, NameTypePair { name: \"limit\", typ: U8(TypeU8) }] }) }]\n})\n```\n\n- @vigoo@ziverge.com Cannot change the component interface if it was used in an API binding, even if I delete all the\n  API deployments and definitions. Looks like the constraint is never removed. (In progress by @Afsal Thaj)\n    - by @Afsal Thaj : https://github.com/golemcloud/golem/pull/1442\n- @vigoo@ziverge.com The → () syntax in our WIT files for function without return value are not compatible with latest\n  tooling (for example wit-bindgen 0.40).\n    - We should update them before the release\n    - https://github.com/golemcloud/golem/pull/1432\n- @Maxim Schuwalow Worker executor sometimes panics during golem app update-workers and cannot recover:\n    - https://github.com/golemcloud/golem/pull/1451\n\n```\nthread 'tokio-runtime-worker' panicked at /home/mschuwalow/.cargo/git/che\nckouts/golem-f136eb08d75a2850/f783c7b/golem-worker-executor-base/src/\nworker/mod.rs:1513:58:\ncalled `Result::unwrap()` on an `Err` value: SendError { .. }\nstack backtrace:\n0: rust_begin_unwind\n1: core::panicking::panic_fmt\n2: core::result::unwrap_failed\n```\n\n### To-do\n\n- Updating workers after reverting one can leave something (we have some local cli cache now, right? I guess that is the\n  culprit) in a broken state\n    - @Maxim Schuwalow taking this\n\n```\nUpdating existing workers using auto mode\nUpdating all workers (1) for component chatroom:inbox to version 2\nTriggering update for worker chatroom:inbox/abc to version 2 using auto up\ndate mode\nFailed to trigger update for worker, error:\nWorker Service - Error: 500 Internal Server Error, Invalid request: The sam\ne update is already in progress\n```\n\n```\n❯ golem worker list\n+----------------+-------------+-----------+--------+-----------------------------+\n| Component name | Worker name | Component | Status | Created at| | | | version | | |\n+----------------+-------------+-----------+--------+-----------------------------+\n| chatroom:inbox | abc | 0 | Idle | 2025-03-18 13:27:44.302 UTC |\n+----------------+-------------+-----------+--------+-----------------------------+\n| chatroom:room | room | 2 | Idle | 2025-03-18 13:07:41.380 UTC |\n+----------------+-------------+-----------+--------+-----------------------------+\n```\n\n## Critical documentation improvements\n\nThis section contains documentation improvements that would be critical to do\nbefore 1.2\n\n### Done\n\n- @vigoo@ziverge.com It is not clear from the documentation how exactly to define API definitions in the current, app\n  manifest based world. Where to put the YAMLs? How many to create? What is the workflow regarding all the other\n  deployment commands? This is something that will change if we integrate API definitions in the app manifest but even\n  until we do so, we should have documentation about it.\n- @vigoo@ziverge.com There is no information at all about how to run the OSS GUI\n    - Even if we cannot solve the signed apps for 1.2, we should have instructions for it\n    - PR - https://github.com/golemcloud/docs/pull/125 we are using the docs for now since the signing process taking\n      time\n- @vigoo@ziverge.com The “HTTP API definition binding types” page is hard to find in the docs. It is in the end of the\n  References section and not cross-linked well enough in other places talking about API definition.\n- Document how to add shared WIT packages into apps\n    - @Maxim Schuwalow wit-deps setting in the golem.yaml does not automatically include the wit/common.wit file even\n      though we automatically generate it\n    - @Maxim Schuwalow Workflow for adding common wit to components is very confusing currently. I would expect to edit\n      the wit file and / or Cargo.toml instead of having to edit the golem.yaml. I think we should automatically\n      generate comments in those files that point out those pitfalls.\n    - @vigoo@ziverge.com working on this\n    - @vigoo@ziverge.com working on this\n    - @vigoo@ziverge.com The file-server binding type description on the “HTTP API definition binding types” page is\n      very confusing - it shows request.path.file but it does not have the part where that file is defined. I could only\n      figure out what to actually do by checking an old CLI test (now deleted from the repo, by the way).\n\n### TODO\n\n- @vigoo@ziverge.com We should have a page about how to use app manifest, IFS, file server binding etc together to host\n  a frontend.\n- @Maxim Schuwalow api-definitions: query parameter bindings are undocumented\n- Using variants and enums from Rib and passing them to invocation\n- ~@Maxim Schuwalow if I search for “golem.yaml” on the documentation website I get no hits. Users will not know that\n  this is called an application manifest, so discoverability should be better here.~\n\n## Non-critical missing features\n\nThe items in this section are missing features that are not mandatory to be solved\nbefore 1.2\n\n### Done\n\n- @vigoo@ziverge.com The CLI should show the component type (ephemeral or durable)\n    - https://github.com/golemcloud/golem-cli/pull/148\n\n### TODO\n\n- @vigoo@ziverge.com There should be an easily extensible set of “standard library” functions exposed to Rib scripts,\n  with some initial elements like base64 encoding/decoding. They could be either implemented as external native\n  functions (in Rust) or in Rib itself if it becomes expressive enough.\n- @vigoo@ziverge.com We should have a version of our reqwest fork that implements the async reqwest API. This could make\n  it a drop-in replacement (via cargo patching) for many Rust libraries (for example AI clients)\n- @vigoo@ziverge.com I think we are missing something to make secured endpoints testable. Not sure what exactly. (And\n  could not test it yet, just based on the current docs). There should be a way to call the protected endpoints without\n  requiring to go to a 3rd party identity provider, for testing purposes. It could be something depending on whether the\n  deployment is “dev” or not, or an option to also allow basic auth or something else.\n- @vigoo@ziverge.com There should be a way to define Rib functions and reuse them in multiple endpoints. Without that\n  there is a lot of redundancy in endpoint definitions.\n- ~@Maxim Schuwalow api definitions: Optional query parameter support. Maybe it’s just hidden and documentation is\n  missing~\n- @Afsal Thaj Generate a full fledged API definition based on component-id, with default METHOD in endpoints as GET and\n  calling each function. The UI can have a Generate tab and cli can have the same functionality. Users can then start\n  “editing” rather than developing a yaml or fill out UI forms from the scratch. They can always delete routes that they\n  don’t need. I hope a user won’t have a 1000 functions exported in the component. In that case we put an upper limit to\n  the number of routes generated. This will also give users an idea of how to write Rib without going through\n  documentation. (In Postgres by @Afsal Thaj partly)\n\n## Non-critical but annoying UX\n\nThe items in this section are annoyances that are nice to have for 1.2, but not\nmandatory\n\n### Done\n\n- @vigoo@ziverge.com The API definition parser is very case sensitive. For example, I was writing GET as a method, and\n  that is a syntax error (it only accepts Get ).\n    - It should be more forgiving, especially for things like method which, I believe, many people write in uppercase by\n      default\n    - https://github.com/golemcloud/golem/pull/1431\n- @vigoo@ziverge.com Why do I have to write --host localhost:9006 when deploying an API to a locally running Golem? It\n  is confusing (and no other value works)\n    - by @Afsal Thaj: https://github.com/golemcloud/golem-cli/pull/150\n- @Afsal Thaj Remove `—def-format` option for api-definition in CLI:\n    - by @Afsal Thaj https://github.com/golemcloud/golem-cli/pull/150\n- @vigoo@ziverge.com the Uri type returned by the worker_uri host function is not the same as the Uri type required by\n  the RPC stubs (they are isomorphic just two separately generated types of the same thing) so there has to be a\n  conversion.\n    - Would be nice to avoid this\n    - Otherwise after 1.2 we should get rid of accepting Uri in those constructors anyway (Question: or before 1.2?)\n    - https://github.com/golemcloud/golem/pull/1432\n- @vigoo@ziverge.com The ValueAndOptionalType does not have pub fields which makes it impossible to use it (through\n  golem-client crate) for testing\n    - https://github.com/golemcloud/golem/pull/1432\n- @Maxim Schuwalow automatic binding generation setup does not reuse generated types from golem_rust. This means that\n  you cannot mix golem_rust returned types with the ones your own code is using. We should configure the binding\n  settings in the Cargo.toml so the types are reused\n\n```\ngolem-rust types mismatch:\n| ---------------------- ^^^^^^^^^^^ expected bindings::golem::rpc::types::Uri, found\ngolem_rust::bindings::golem::rpc::types::Uri\n```\n\n    - https://github.com/golemcloud/golem/pull/1432\n\n- @Maxim Schuwalow It would be nice to get rid of having to type the component name when interacting with generated\n  clients. Here we should be able to figure out the name of the component from the golem.yaml / dynamic linking data\n  uploaded to the server and offer a constructor for the client that just takes the worker name:\n    - https://github.com/golemcloud/golem/pull/1432\n\n```\nlet client_component_id = resolve_component_id(\"chatroom:inbox\").unwrap\n();\nfor client_name in state.connected_clients.iter() {\nlet client_uri = worker_uri(&WorkerId {\ncomponent_id: client_component_id.clone(),\nworker_name: client_name.clone()\n});\nlet client_api = ChatroomInboxApi::new(&client_uri);\n...\n```\n\n- @vigoo@ziverge.com The Rust templates should add a #[allow(static_mut_ref)] before mod bindings to get rid of some\n  warnings\n- @vigoo@ziverge.com The default component templates are adding the common-lib crate as a dependency. Because of this,\n  if I rename that crate to something, and then keep adding new components, those are no longer build because there is\n  no longer a common-lib crate in the workspace.\n    - I think we should only have the common-lib dependency in a “commented-out” form as a hint how to add it\n- @Maxim Schuwalow We should include a link to documentation in the golem.yaml. The schema for the various editors work,\n  but an overview that is easy to access would also be helpful. Alternatively we could generate commented out fields for\n  the various settings with comments, as many settings files often do.\n\n### To-do / In-progress\n\n- @vigoo@ziverge.com the last published JSON schema (1.1.1) seems to be outdated (for example no static-wasm-rpc\n  dependency type in it)\n- @vigoo@ziverge.com the rust component templates now have a commented-out binding customization section in the end of\n  their Cargo.toml But the cargo file rewrite adds new sections and it does not keep the comments together with the\n  bindings section so it gets confusing.\n    - Either the binding section header should be commented out too, or the target section (that gets manipulated by the\n      tool) has to be added to the template\n- @vigoo@ziverge.com Cargo.toml related up-to-date check issue - seems like if I only edit the binding customization\n  section in the file, then golem app build is not rebuilding the component\n- @vigoo@ziverge.com The error types generated into golem-client are bad in many ways. One user facing problem is, if\n  the client crate is used for integration testing user applications, the errors cannot be ? d because they do not\n  implement the Error trait.\n    - At least we should implement the error trait for more convenient use, regardless of doing bigger changes to it\n      later\n- @vigoo@ziverge.com When the API definition points to wrong component IDs or versions (for example because the server\n  was restarted with --clean ), the error response of registering the API definition is very bad: it contains the list\n  of wrong component IDs for each endpoint, without mentioning which endpoint, with many duplicates (one entry per\n  endpoint). For example:\n\n```\nerror: API\nDefinition Service - Error: 400 Bad Request, Unable to fetch component: e3453d02-6e40-4827-bc29-\nd1edf0d132dd#5, e3453d02-6e40-4827-bc29-d1edf0d132dd#5, b93c7c43-6dd7-437f-b126-35c7ccb18de5#11,\nb93c7c43-6dd7-437f-b126-35c7ccb18de5#11, b93c7c43-6dd7-437f-b126-35c7ccb18de5#11, b93c7c43-6dd7-\n437f-b126-35c7ccb18de5#10, 185c45ec-5c2d-460c-9415-093046f14142#6, 185c45ec-5c2d-460c-9415-\n093046f14142#6, 185c45ec-5c2d-460c-9415-093046f14142#6\n```\n\n- @Maxim Schuwalow It would be nice to allow adding dependencies directly using the golem cli. An additional flag during\n  component creation that automatically adjusts the golem.yaml. Otherwise discoverability of dependency settings is a\n  bit bad. The same applies for common wit dependencies.\n- @Afsal Thaj Have a separate compilation phase that string concatenation doesn’t include non literals. This behaviour\n  needs to be confirmed. I think its a good idea to do this, especially users use it form worker-ids atleast as of\n  now. (In progress by @Afsal Thaj)\n- @Maxim Schuwalow : Static validation of query and path parameters than at runtime for Rib. It will reduce the\n  difficulty in debugging when user accidentally uses request.path.* in Rib, and passed a request.query parameter.\n\n## Wrong UX not immediately fixable\n\nThis section contains items that are important usability issues, but we don’t think\nthey can be fixed before 1.2\n\n- @vigoo@ziverge.com The development flow of iterating on API definitions is very annoying. Basically it requires to:\n    - Update the API yaml file\n    - Manually bump the version in it\n    - Register the new version ( golem api definition new api.yaml )\n    - Delete the old deployment ( golem api deployment delete localhost:9006 )\n    - Deploy the new version ( golem api deployment deploy my-api/0.0.1 )\n    - Because of the version bump requirement and that the version is in the last command, it is not even easy to\n      automate.\n        - I think the solution is to integrate the API definitions in the app manifest and make it part of golem app\n          deploy\n- @Maxim Schuwalow trivial changes like adding a println! can fail worker updates. It would be nice to be more\n  permissive here\n\n```\n2025-03-18T13:46:05.573910Z ERROR api_request{api=\"invoke_and_awai\nt_worker_typed\" api_type=\"grpc\" worker_id=\"e34fb6b8-4e6d-4cea-915e\n-ceb93e7e1d5e/room\" account_id=\"-1\"}:waiting-for-permits{worker_id=\"e\n34fb6b8-4e6d-4cea-915e-ceb93e7e1d5e/room\"}:invocation-loop{worker\n_id=\"e34fb6b8-4e6d-4cea-915e-ceb93e7e1d5e/room\"}:invocation{worke\nGolem 1.2 internal testing hackathon results 15r_id=e34fb6b8-4e6d-4cea-915e-ceb93e7e1d5e/room}:replaying{function\n=\"chatroom:room-exports/chatroom-room-api.{send}\"}: golem_worker_ex\necutor_base::durable_host::durability: Unexpected imported function call\nentry in oplog: expected cli::preopens::get_directories, got golem_environ\nment::get_arguments\n```\n\n- https://github.com/golemcloud/golem/pull/1432\n\n"
